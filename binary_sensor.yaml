binary_sensor:
  - platform: status
    name: Online
    id: ink_ha_connected

  - platform: ld2410
    has_target:
      name: Presence
      id: ld2410_has_target
      # on_state:
      #   then:
      #     - component.update: presence_filtered   # âŒ binary_sensor nie wspiera update
    has_moving_target:
      name: Moving Target
    has_still_target:
      name: Still Target

  - platform: gpio
    name: "OUT Pin"
    id: ld2410_out_pin
    pin:
      number: GPIO16
      mode:
        input: true
        pullup: false
      inverted: false
    device_class: motion

  # ===== STREFA 1 =====
  - platform: template
    id: presence_zone_1
    name: "Presence Zone 1"
    device_class: occupancy
    filters:
      - delayed_off: 3s
    lambda: |-
      if (!id(ld2410_has_target).state) return false;

      if (id(shower_mode).state) {
        if (!id(still_distance).has_state()) return false;
      }

      float d = 0;
      if (id(detection_distance).has_state() && id(detection_distance).state > 0) {
        d = id(detection_distance).state;
      } else {
        return true;
      }

      if (id(ignore_static_reflections).state) {
        if (id(still_energy).has_state() && id(still_energy).state < 30) {
          return false;
        }
      }

      return d >= id(zone1_min_distance).state &&
             d <= id(zone1_max_distance).state;

  # ===== STREFA 2 =====
  - platform: template
    id: presence_zone_2
    name: "Presence Zone 2"
    device_class: occupancy
    filters:
      - delayed_off: 5s
    lambda: |-
      if (!id(ld2410_has_target).state) return false;
      if (!id(detection_distance).has_state() || id(detection_distance).state <= 0) return false;

      float d = id(detection_distance).state;
      return d >= id(zone2_min_distance).state &&
             d <= id(zone2_max_distance).state;
